(function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window,b.signalR=a()}})(function(){return function b(c,d,e){function a(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof require&&require;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var f=d[h]={exports:{}};c[h][0].call(f.exports,function(b){var d=c[h][1][b];return a(d?d:b)},f,f.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof require&&require,f=0;f<e.length;f++)a(e[f]);return a}({1:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.Base64EncodedHubProtocol=class{constructor(a){this.wrappedProtocol=a,this.name=this.wrappedProtocol.name,this.type=1}parseMessages(a){let b=a.indexOf(":");if(-1==b||";"!=a[a.length-1])throw new Error("Invalid payload.");let c=a.substring(0,b);if(!/^[0-9]+$/.test(c))throw new Error(`Invalid length: '${c}'`);let d=parseInt(c,10);if(d!=a.length-b-2)throw new Error("Invalid message size.");let e=a.substring(b+1,a.length-1),f=atob(e),g=new Uint8Array(f.length);for(let b=0;b<g.length;b++)g[b]=f.charCodeAt(b);return this.wrappedProtocol.parseMessages(g.buffer)}writeMessage(a){let b=new Uint8Array(this.wrappedProtocol.writeMessage(a)),c="";for(let d=0;d<b.byteLength;d++)c+=String.fromCharCode(b[d]);let d=btoa(c);return`${d.length.toString()}:${d};`}}},{}],2:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d;(function(a){const b="\x1E";a.write=function(a){return`${a}${b}`},a.parse=function(a){if(a[a.length-1]!=b)throw new Error("Message is incomplete.");let c=a.split(b);return c.pop(),c}})(d=c.TextMessageFormat||(c.TextMessageFormat={}));var e;(function(a){a.write=function(a){let b=a.byteLength||a.length,c=[];do{let a=127&b;b>>=7,0<b&&(a|=128),c.push(a)}while(0<b);b=a.byteLength||a.length;let d=new Uint8Array(c.length+b);return d.set(c,0),d.set(a,c.length),d.buffer},a.parse=function(a){let b=[],c=new Uint8Array(a);const d=5,e=[0,7,14,21,28];for(let f=0;f<a.byteLength;){let g,h=0,i=0;do g=c[f+h],i|=(127&g)<<e[h],h++;while(h<Math.min(d,a.byteLength-f)&&0!=(128&g));if(0!=(128&g)&&h<d)throw new Error("Cannot read message size.");if(h==d&&7<g)throw new Error("Messages bigger than 2GB are not supported.");if(c.byteLength>=f+h+i)b.push(c.slice?c.slice(f+h,f+h+i):c.subarray(f+h,f+h+i));else throw new Error("Incomplete message.");f=f+h+i}return b}})(e=c.BinaryMessageFormat||(c.BinaryMessageFormat={}))},{}],3:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});const d=a("./HttpError");c.HttpClient=class{get(a,b){return this.xhr("GET",a,b)}options(a,b){return this.xhr("OPTIONS",a,b)}post(a,b,c){return this.xhr("POST",a,c,b)}xhr(a,b,c,e){return new Promise((f,g)=>{let h=new XMLHttpRequest;h.open(a,b,!0),h.setRequestHeader("X-Requested-With","XMLHttpRequest"),c&&c.forEach((a,b)=>h.setRequestHeader(b,a)),h.send(e),h.onload=()=>{200<=h.status&&300>h.status?f(h.response||h.responseText):g(new d.HttpError(h.statusText,h.status))},h.onerror=()=>{g(new d.HttpError(h.statusText,h.status))}})}}},{"./HttpError":5}],4:[function(a,b,c){"use strict";var d=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0});const e=a("./Transports"),f=a("./HttpClient"),g=a("./ILogger"),h=a("./Loggers");c.HttpConnection=class{constructor(a,b={}){this.features={},this.logger=h.LoggerFactory.createLogger(b.logging),this.url=this.resolveUrl(a),b=b||{},this.httpClient=b.httpClient||new f.HttpClient,this.connectionState=0,this.options=b}start(){return d(this,void 0,void 0,function*(){return 0==this.connectionState?(this.connectionState=1,this.startPromise=this.startInternal(),this.startPromise):Promise.reject(new Error("Cannot start a connection that is not in the 'Initial' state."))})}startInternal(){return d(this,void 0,void 0,function*(){try{let a=yield this.httpClient.options(this.url),b=JSON.parse(a);if(this.connectionId=b.connectionId,3==this.connectionState)return;this.url+=(-1==this.url.indexOf("?")?"?":"&")+`id=${this.connectionId}`,this.transport=this.createTransport(this.options.transport,b.availableTransports),this.transport.onreceive=this.onreceive,this.transport.onclose=(a)=>this.stopConnection(!0,a);let c=2===this.features.transferMode?2:1;this.features.transferMode=yield this.transport.connect(this.url,c),this.changeState(1,2)}catch(a){throw this.logger.log(g.LogLevel.Error,"Failed to start the connection. "+a),this.connectionState=3,this.transport=null,a}})}createTransport(a,b){if(!a&&0<b.length&&(a=e.TransportType[b[0]]),a===e.TransportType.WebSockets&&0<=b.indexOf(e.TransportType[a]))return new e.WebSocketTransport(this.logger);if(a===e.TransportType.ServerSentEvents&&0<=b.indexOf(e.TransportType[a]))return new e.ServerSentEventsTransport(this.httpClient,this.logger);if(a===e.TransportType.LongPolling&&0<=b.indexOf(e.TransportType[a]))return new e.LongPollingTransport(this.httpClient,this.logger);if(this.isITransport(a))return a;throw new Error("No available transports found.")}isITransport(a){return"object"==typeof a&&"connect"in a}changeState(a,b){return!(this.connectionState!=a)&&(this.connectionState=b,!0)}send(a){if(2!=this.connectionState)throw new Error("Cannot send data if the connection is not in the 'Connected' State");return this.transport.send(a)}stop(){return d(this,void 0,void 0,function*(){let a=this.connectionState;this.connectionState=3;try{yield this.startPromise}catch(a){}this.stopConnection(2==a)})}stopConnection(a,b){this.transport&&(this.transport.stop(),this.transport=null),this.connectionState=3,a&&this.onclose&&this.onclose(b)}resolveUrl(a){if(0===a.lastIndexOf("https://",0)||0===a.lastIndexOf("http://",0))return a;if("undefined"==typeof window||!window||!window.document)throw new Error(`Cannot resolve '${a}'.`);let b=window.document.createElement("a");b.href=a;let c=b.protocol&&":"!==b.protocol?`${b.protocol}//${b.host}`:`${window.document.location.protocol}//${b.host||window.document.location.host}`;a&&"/"==a[0]||(a="/"+a);let d=c+a;return this.logger.log(g.LogLevel.Information,`Normalizing '${a}' to '${d}'`),d}}},{"./HttpClient":3,"./ILogger":7,"./Loggers":9,"./Transports":11}],5:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});class d extends Error{constructor(a,b){super(a),this.statusCode=b}}c.HttpError=d},{}],6:[function(a,b,c){"use strict";var d=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0});const e=a("./HttpConnection"),f=a("./Observable"),g=a("./JsonHubProtocol"),h=a("./Formatters"),i=a("./Base64EncodedHubProtocol"),j=a("./ILogger"),k=a("./Loggers");var l=a("./Transports");c.TransportType=l.TransportType;var m=a("./HttpConnection");c.HttpConnection=m.HttpConnection;var n=a("./JsonHubProtocol");c.JsonHubProtocol=n.JsonHubProtocol;var o=a("./ILogger");c.LogLevel=o.LogLevel;var p=a("./Loggers");c.ConsoleLogger=p.ConsoleLogger,c.NullLogger=p.NullLogger;c.HubConnection=class{constructor(a,b={}){b=b||{},this.connection="string"==typeof a?new e.HttpConnection(a,b):a,this.logger=k.LoggerFactory.createLogger(b.logging),this.protocol=b.protocol||new g.JsonHubProtocol,this.connection.onreceive=(a)=>this.processIncomingData(a),this.connection.onclose=(a)=>this.connectionClosed(a),this.callbacks=new Map,this.methods=new Map,this.closedCallbacks=[],this.id=0}processIncomingData(a){let b=this.protocol.parseMessages(a);for(var c,d=0;d<b.length;++d)switch(c=b[d],c.type){case 1:this.invokeClientMethod(c);break;case 2:case 3:let e=this.callbacks.get(c.invocationId);null!=e&&(3==c.type&&this.callbacks.delete(c.invocationId),e(c));break;default:this.logger.log(j.LogLevel.Warning,"Invalid message type: "+a);}}invokeClientMethod(a){let b=this.methods.get(a.target.toLowerCase());b?(b.forEach((b)=>b.apply(this,a.arguments)),!a.nonblocking):this.logger.log(j.LogLevel.Warning,`No client method with the name '${a.target}' found.`)}connectionClosed(a){let b={type:3,invocationId:"-1",error:a?a.message:"Invocation cancelled due to connection being closed."};this.callbacks.forEach((a)=>{a(b)}),this.callbacks.clear(),this.closedCallbacks.forEach((b)=>b.apply(this,[a]))}start(){return d(this,void 0,void 0,function*(){let a=2===this.protocol.type?2:1;this.connection.features.transferMode=a,yield this.connection.start();var b=this.connection.features.transferMode;yield this.connection.send(h.TextMessageFormat.write(JSON.stringify({protocol:this.protocol.name}))),this.logger.log(j.LogLevel.Information,`Using HubProtocol '${this.protocol.name}'.`),2==a&&1===b&&(this.protocol=new i.Base64EncodedHubProtocol(this.protocol))})}stop(){return this.connection.stop()}stream(a,...b){let c=this.createInvocation(a,b,!1),d=new f.Subject;this.callbacks.set(c.invocationId,(a)=>{if(3===a.type){let b=a;b.error?d.error(new Error(b.error)):b.result?d.error(new Error("Server provided a result in a completion response to a streamed invocation.")):d.complete()}else d.next(a.item)});let e=this.protocol.writeMessage(c);return this.connection.send(e).catch((a)=>{d.error(a),this.callbacks.delete(c.invocationId)}),d}send(a,...b){let c=this.createInvocation(a,b,!0),d=this.protocol.writeMessage(c);return this.connection.send(d)}invoke(a,...b){let c=this.createInvocation(a,b,!1),d=new Promise((a,b)=>{this.callbacks.set(c.invocationId,(c)=>{if(3===c.type){let d=c;d.error?b(new Error(d.error)):a(d.result)}else b(new Error("Streaming methods must be invoked using HubConnection.stream"))});let d=this.protocol.writeMessage(c);this.connection.send(d).catch((a)=>{b(a),this.callbacks.delete(c.invocationId)})});return d}on(a,b){a&&b&&(a=a.toLowerCase(),!this.methods.has(a)&&this.methods.set(a,[]),this.methods.get(a).push(b))}off(a,b){if(a&&b){a=a.toLowerCase();let d=this.methods.get(a);if(d){var c=d.indexOf(b);-1!=c&&d.splice(c,1)}}}onclose(a){a&&this.closedCallbacks.push(a)}createInvocation(a,b,c){let d=this.id;return this.id++,{type:1,invocationId:d.toString(),target:a,arguments:b,nonblocking:c}}}},{"./Base64EncodedHubProtocol":1,"./Formatters":2,"./HttpConnection":4,"./ILogger":7,"./JsonHubProtocol":8,"./Loggers":9,"./Observable":10,"./Transports":11}],7:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d;(function(a){a[a.Trace=0]="Trace",a[a.Information=1]="Information",a[a.Warning=2]="Warning",a[a.Error=3]="Error",a[a.None=4]="None"})(d=c.LogLevel||(c.LogLevel={}))},{}],8:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});const d=a("./Formatters");c.JsonHubProtocol=class{constructor(){this.name="json",this.type=1}parseMessages(a){if(!a)return[];let b=d.TextMessageFormat.parse(a),c=[];for(var e=0;e<b.length;++e)c.push(JSON.parse(b[e]));return c}writeMessage(a){return d.TextMessageFormat.write(JSON.stringify(a))}}},{"./Formatters":2}],9:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});const d=a("./ILogger");class e{log(){}}c.NullLogger=e;class f{constructor(a){this.minimumLogLevel=a}log(a,b){a>=this.minimumLogLevel&&console.log(`${d.LogLevel[a]}: ${b}`)}}c.ConsoleLogger=f;var g;(function(a){a.createLogger=function(a){return void 0===a?new f(d.LogLevel.Information):null===a?new e:a.log?a:new f(a)}})(g=c.LoggerFactory||(c.LoggerFactory={}))},{"./ILogger":7}],10:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.Subject=class{constructor(){this.observers=[]}next(a){for(let b of this.observers)b.next(a)}error(a){for(let b of this.observers)b.error(a)}complete(){for(let a of this.observers)a.complete()}subscribe(a){this.observers.push(a)}}},{}],11:[function(a,b,c){"use strict";function d(a,b,c){return e(this,void 0,void 0,function*(){yield a.post(b,c,i)})}var e=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0});const f=a("./HttpError"),g=a("./ILogger");var h;(function(a){a[a.WebSockets=0]="WebSockets",a[a.ServerSentEvents=1]="ServerSentEvents",a[a.LongPolling=2]="LongPolling"})(h=c.TransportType||(c.TransportType={}));c.WebSocketTransport=class{constructor(a){this.logger=a}connect(a,b){return new Promise((c,d)=>{a=a.replace(/^http/,"ws");let e=new WebSocket(a);2==b&&(e.binaryType="arraybuffer"),e.onopen=()=>{this.logger.log(g.LogLevel.Information,`WebSocket connected to ${a}`),this.webSocket=e,c(b)},e.onerror=()=>{d()},e.onmessage=(a)=>{this.logger.log(g.LogLevel.Trace,`(WebSockets transport) data received: ${a.data}`),this.onreceive&&this.onreceive(a.data)},e.onclose=(a)=>{this.onclose&&this.webSocket&&(!1===a.wasClean||1e3!==a.code?this.onclose(new Error(`Websocket closed with status code: ${a.code} (${a.reason})`)):this.onclose())}})}send(a){return this.webSocket&&this.webSocket.readyState===WebSocket.OPEN?(this.webSocket.send(a),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){this.webSocket&&(this.webSocket.close(),this.webSocket=null)}};c.ServerSentEventsTransport=class{constructor(a,b){this.httpClient=a,this.logger=b}connect(a){return"undefined"==typeof EventSource&&Promise.reject("EventSource not supported by the browser."),this.url=a,new Promise((a,b)=>{let c=new EventSource(this.url);try{c.onmessage=(a)=>{if(this.onreceive)try{this.logger.log(g.LogLevel.Trace,`(SSE transport) data received: ${a.data}`),this.onreceive(a.data)}catch(a){return void(this.onclose&&this.onclose(a))}},c.onerror=(a)=>{b(),this.eventSource&&this.onclose&&this.onclose(new Error(a.message||"Error occurred"))},c.onopen=()=>{this.logger.log(g.LogLevel.Information,`SSE connected to ${this.url}`),this.eventSource=c,a(1)}}catch(a){return Promise.reject(a)}})}send(a){return e(this,void 0,void 0,function*(){return d(this.httpClient,this.url,a)})}stop(){this.eventSource&&(this.eventSource.close(),this.eventSource=null)}};c.LongPollingTransport=class{constructor(a,b){this.httpClient=a,this.logger=b}connect(a,b){if(this.url=a,this.shouldPoll=!0,2===b&&"string"!=typeof new XMLHttpRequest().responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return this.poll(this.url,b),Promise.resolve(b)}poll(a,b){if(!this.shouldPoll)return;let c=new XMLHttpRequest;c.onload=()=>{if(200==c.status){if(this.onreceive)try{let a=1===b?c.responseText:c.response;a?(this.logger.log(g.LogLevel.Trace,`(LongPolling transport) data received: ${a}`),this.onreceive(a)):this.logger.log(g.LogLevel.Information,"(LongPolling transport) timed out")}catch(a){return void(this.onclose&&this.onclose(a))}this.poll(a,b)}else 204==this.pollXhr.status?this.onclose&&this.onclose():this.onclose&&this.onclose(new f.HttpError(c.statusText,c.status))},c.onerror=()=>{this.onclose&&this.onclose(new Error("Sending HTTP request failed."))},c.ontimeout=()=>{this.poll(a,b)},this.pollXhr=c,this.pollXhr.open("GET",`${a}&_=${Date.now()}`,!0),2===b&&(this.pollXhr.responseType="arraybuffer"),this.pollXhr.timeout=1.2e5,this.pollXhr.send()}send(a){return e(this,void 0,void 0,function*(){return d(this.httpClient,this.url,a)})}stop(){this.shouldPoll=!1,this.pollXhr&&(this.pollXhr.abort(),this.pollXhr=null)}};const i=new Map},{"./HttpError":5,"./ILogger":7}]},{},[6])(6)});