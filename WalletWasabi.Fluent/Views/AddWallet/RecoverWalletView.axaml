<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:recoverWallet="using:WalletWasabi.Fluent.ViewModels.AddWallet"
             mc:Ignorable="d" d:DesignWidth="428" d:DesignHeight="371"
             x:DataType="recoverWallet:RecoverWalletViewModel"
             x:CompileBindings="True"
             x:Class="WalletWasabi.Fluent.Views.AddWallet.RecoverWalletView">
  <ContentArea Title="{Binding Title}"
               CancelContent="Cancel"
               EnableCancel="{Binding EnableCancel}"
               EnableBack="{Binding EnableBack}"
               EnableNext="True" NextContent="Continue"
               IsBusy="{Binding IsBusy}">

    <DockPanel HorizontalAlignment="Stretch">

      <Button Classes="h7 plain activeHyperLink" Margin="0 10 0 0"
              DockPanel.Dock="Bottom"
              HorizontalAlignment="Center"
              VerticalAlignment="Bottom"
              Command="{Binding AdvancedRecoveryOptionsDialogCommand}"
              Content="Advanced Recovery Options" />

      <Grid x:Name="Layout" HorizontalAlignment="Center">
        <Grid.RowDefinitions>
          <RowDefinition MinHeight="70" Height="*" />
          <RowDefinition Height="16" />
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
          <RowDefinition Height="20" />
        </Grid.RowDefinitions>

        <Panel Grid.Row="2" VerticalAlignment="Center" HorizontalAlignment="Center"
               MinWidth="690">
          <ItemsControl ItemsSource="{Binding ConfirmationWords}"
                        Name="ItemsControl">
            <Interaction.Behaviors>
              <ExecuteCommandOnKeyDownBehavior Command="{Binding NextWordCommand}"
                                               KeyGesture="Tab"
                                               EventRoutingStrategy="Bubble, Tunnel" />
              <ExecuteCommandOnKeyDownBehavior Command="{Binding NextWordCommand}"
                                               KeyGesture="Enter"
                                               EventRoutingStrategy="Bubble, Tunnel" />
              <ExecuteCommandOnKeyDownBehavior Command="{Binding PreviousWordCommand}"
                                               KeyGesture="Shift+Tab"
                                               EventRoutingStrategy="Bubble, Tunnel" />
            </Interaction.Behaviors>
            <ItemsControl.Styles>
              <Style Selector="TextBlock.error">
                <Setter Property="Foreground" Value="{DynamicResource SystemErrorTextColor}" />
              </Style>
            </ItemsControl.Styles>
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <WrapPanel MaxHeight="200" Orientation="Vertical" VerticalAlignment="Top" HorizontalAlignment="Center" />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Panel Margin="0,0,0,5">

                  <StackPanel IsVisible="{Binding !IsSelected}"
                              Margin="15 0 15 0"
                              Width="200"
                              Orientation="Horizontal"
                              Background="Transparent">
                    <Interaction.Behaviors>
                      <RoutedEventTriggerBehavior RoutedEvent="{x:Static InputElement.DoubleTappedEvent}"
                                                  RoutingStrategies="Bubble">
                        <InvokeCommandAction Command="{Binding #ItemsControl.((recoverWallet:RecoverWalletViewModel)DataContext).SelectWordCommand}"
                                             CommandParameter="{Binding .}"/>
                      </RoutedEventTriggerBehavior>
                    </Interaction.Behaviors>
                    <PathIcon Name="WordIconCheckmark"
                              Margin="0 0 15 0"
                              Classes="checkMark"
                              VerticalAlignment="Center"
                              Opacity="{Binding #ItemsControl.((recoverWallet:RecoverWalletViewModel)DataContext).IsMnemonicsValid}" />
                    <Panel Height="45"
                           VerticalAlignment="Stretch">
                      <TextBlock Text="{Binding Index, Mode=OneWay, StringFormat={}{0}.}"
                                 Opacity="0.5"
                                 FontSize="{DynamicResource FontSizeH6}"
                                 VerticalAlignment="Center" />
                    </Panel>
                    <Panel VerticalAlignment="Stretch"
                           HorizontalAlignment="Stretch"
                           Width="100"
                           Height="45">
                    <TextBlock Text="{Binding Word}"
                               FontWeight="SemiBold"
                               Margin="5 0 0 0"
                               Classes.error="{Binding !IsConfirmed}"
                               FontSize="{DynamicResource FontSizeH6}"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Stretch" />
                    </Panel>
                  </StackPanel>

                  <DockPanel IsVisible="{Binding IsSelected}"
                             Margin="15 0 15 0"
                             Width="200">
                    <PathIcon Name="IconCheckmark"
                              Margin="0 0 15 0"
                              Classes="checkMark"
                              VerticalAlignment="Center"
                              DockPanel.Dock="Left"
                              Opacity="{Binding #ItemsControl.((recoverWallet:RecoverWalletViewModel)DataContext).IsMnemonicsValid}" />
                    <Panel DockPanel.Dock="Left"
                           Height="45"
                           VerticalAlignment="Stretch">
                      <TextBlock Text="{Binding Index, Mode=OneWay, StringFormat={}{0}.}"
                                 Opacity="0.5"
                                 FontSize="{DynamicResource FontSizeH6}"
                                 VerticalAlignment="Center"/>
                    </Panel>
                    <TagsBoxAutoCompleteBox ItemsSource="{Binding Suggestions}"
                                            Text="{Binding Word}"
                                            FilterMode="StartsWith"
                                            MinimumPrefixLength="0"
                                            Width="150"
                                            Margin="5 0 0 0"
                                            Theme="{StaticResource TagsBoxAutoCompleteBox}">
                      <TagsBoxAutoCompleteBox.Styles>
                        <Style Selector="AutoCompleteBox">
                          <Setter Property="VerticalAlignment" Value="Center" />
                          <Setter Property="Focusable" Value="True" />
                          <Setter Property="MinimumPrefixLength" Value="0" />
                        </Style>
                        <Style Selector="AutoCompleteBox /template/ TextBox#PART_TextBox /template/ Border#PART_BorderElement">
                          <Setter Property="IsVisible" Value="True" />
                          <Setter Property="Focusable" Value="True" />
                        </Style>
                      </TagsBoxAutoCompleteBox.Styles>
                      <Interaction.Behaviors>
                        <FocusBehavior IsFocused="{Binding IsSelected, Mode=OneWay}" />
                      </Interaction.Behaviors>
                    </TagsBoxAutoCompleteBox>
                  </DockPanel>

                </Panel>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>

          <Grid ColumnDefinitions="*,1,*,1,*">
            <Separator Classes="vertical" Grid.Column="1" Margin="0 5 0 15" />
            <Separator Classes="vertical" Grid.Column="3" Margin="0 5 0 15" />
          </Grid>
        </Panel>

        <CopyablePasswordTextBox Grid.Row="3"
                                 Watermark="Type the passphrase (13th word)"
                                 Text="{Binding Passphrase}"
                                 PasswordChar=""
                                 Classes="hasCheckMark copyablePasswordTextBox"
                                 MaxWidth="400"
                                 VerticalAlignment="Top"
                                 Margin="0,30,0,0">
          <Interaction.Behaviors>
            <FocusBehavior IsFocused="{Binding FocusPassphrase, Mode=OneWay}" />
          </Interaction.Behaviors>
        </CopyablePasswordTextBox>

      </Grid>

    </DockPanel>

  </ContentArea>
</UserControl>
