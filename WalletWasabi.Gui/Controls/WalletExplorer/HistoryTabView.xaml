<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:behaviors="clr-namespace:WalletWasabi.Gui.Behaviors;assembly=WalletWasabi.Gui"
             xmlns:i="clr-namespace:Avalonia.Xaml.Interactivity;assembly=Avalonia.Xaml.Interactivity"
             xmlns:converters="clr-namespace:WalletWasabi.Gui.Converters;assembly=WalletWasabi.Gui"
             xmlns:controls="clr-namespace:WalletWasabi.Gui.Controls;assembly=WalletWasabi.Gui">
  <i:Interaction.Behaviors>
    <behaviors:ClearPropertyOnLostFocusBehavior TargetProperty="{Binding SelectedTransaction}" />
  </i:Interaction.Behaviors>
  <UserControl.Resources>
    <converters:MoneyBrushConverter x:Key="MoneyBrushConverter" />
    <converters:LurkingWifeModeStringConverter x:Key="LurkingWifeModeStringConverter" />
    <converters:CoinItemExpanderColorConverter x:Key="CoinItemExpanderColorConverter" />
    <converters:BooleanStringConverter x:Key="BooleanStringConverter" />
  </UserControl.Resources>
  <controls:GroupBox Title="{Binding Title}" TextBlock.FontSize="30" Padding="20" Margin="10">
    <Grid Classes="content">
      <DockPanel LastChildFill="True">
        <Popup Height="200" Width="650" IsOpen="{Binding TxInfoPopOpen}" PlacementMode="Pointer">
          <controls:GroupBox Title="{Binding SelectedTxId}" TextBlock.FontSize="16" Padding="10" Margin="0 5 10 5">
            <StackPanel Orientation="Vertical" HorizontalAlignment="Left" Margin="0 5 10 5">
              <Grid HorizontalAlignment="Left" ColumnDefinitions="200, *" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto" MaxWidth="800" Margin="35 10 0 25">
                <TextBlock Text="Confirmations:" Grid.Row="0" />
                <controls:ExtendedTextBox Classes="selectableTextBlock Transaparent" Text="{Binding SelectedTxConfirmations}" Grid.Column="1" Grid.Row="0" />
                <TextBlock Text="Block Height:" Grid.Row="1" />
                <controls:ExtendedTextBox Classes="selectableTextBlock Transaparent" Text="{Binding SelectedTxBlockHeight}" Grid.Column="1" Grid.Row="1" />
                <TextBlock Text="Size:" Grid.Row="2" />
                <controls:ExtendedTextBox Classes="selectableTextBlock Transaparent" Text="{Binding SelectedTxSize, StringFormat=\{0\} bytes, Mode=OneWay}" Grid.Column="1" Grid.Row="2" />
                <TextBlock Text="Virtual Size:" Grid.Row="3" />
                <controls:ExtendedTextBox Classes="selectableTextBlock Transaparent" Text="{Binding SelectedTxVirtualSize, StringFormat=\{0\} vbytes, Mode=OneWay}" Grid.Column="1" Grid.Row="3" />
                <TextBlock Text="Fees:" Grid.Row="4" />
                <controls:ExtendedTextBox Classes="selectableTextBlock Transaparent" Text="{Binding SelectedTxFees}" Grid.Column="1" Grid.Row="4" />
                <TextBlock Text="Replace-by-fee:" Grid.Row="5" />
                <controls:ExtendedTextBox Classes="selectableTextBlock Transaparent" Text="{Binding SelectedTxRBF, Converter={StaticResource BooleanStringConverter}, ConverterParameter=Yes:No, Mode=OneWay}" Grid.Column="1" Grid.Row="5" />
              </Grid>
            </StackPanel>
          </controls:GroupBox>
        </Popup>
        <DockPanel LastChildFill="True">
          <Grid ColumnDefinitions="40, 160, 150, 600, *" Margin="10 0 0 0" DockPanel.Dock="Top">
            <TextBlock Text="" />
            <controls:SortingArrow Grid.Column="1" Command="{Binding SortCommand}" Text="Date" SortDirection="{Binding DateSortDirection}" />
            <controls:SortingArrow Grid.Column="2" Command="{Binding SortCommand}" Text="Amount (BTC)" SortDirection="{Binding AmountSortDirection}" />
            <controls:SortingArrow Grid.Column="3" Command="{Binding SortCommand}" Text="Transaction ID" SortDirection="{Binding TransactionSortDirection}" />
            <controls:SortingArrow Grid.Column="4" Command="{Binding SortCommand}" Text="Label" SortDirection="{Binding LabelSortDirection}" />
          </Grid>
          <controls:BusyIndicator Text="Loading..." IsBusy="{Binding IsFirstLoading}">
            <controls:ExtendedListBox Name="ListBox" Items="{Binding Transactions}" SelectedItem="{Binding SelectedTransaction, Mode=TwoWay}">
              <controls:ExtendedListBox.ContextMenu>
                <ContextMenu>
                  <MenuItem Header="Show Transaction Details" Command="{Binding ShowTransactionDetailsCommand}">
                    <MenuItem.Icon>
                      <Path HorizontalAlignment="Left" Data="M256 40c118.621 0 216 96.075 216 216 0 119.291-96.61 216-216 216-119.244 0-216-96.562-216-216 0-119.203 96.602-216 216-216m0-32C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm-36 344h12V232h-12c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h48c6.627 0 12 5.373 12 12v140h12c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12h-72c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12zm36-240c-17.673 0-32 14.327-32 32s14.327 32 32 32 32-14.327 32-32-14.327-32-32-32z" Fill="#22B14C" Height="16" Width="16" Stretch="Fill" />
                    </MenuItem.Icon>
                  </MenuItem>
                  <MenuItem Header="Copy Transaction Id" Command="{Binding CopySelectedTxIdCommand}">
                    <MenuItem.Icon>
                      <Path HorizontalAlignment="Left" Data="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" Fill="#22B14C" Height="16" Width="16" Stretch="Fill" />
                    </MenuItem.Icon>
                  </MenuItem>
                </ContextMenu>
              </controls:ExtendedListBox.ContextMenu>
              <controls:ExtendedListBox.ItemTemplate>
                <DataTemplate>
                  <Grid>
                    <Grid Margin="0 0 0 0" VerticalAlignment="Top" ColumnDefinitions="40, 160, 150, 600, *">
                      <Border Background="Transparent" IsVisible="{Binding Confirmed}" Grid.Column="0" ToolTip.Tip="{Binding Confirmations, StringFormat=\{0\} Confirmations}">
                        <Path HorizontalAlignment="Center" Data="F1 M 23.7501,33.25L 34.8334,44.3333L 52.2499,22.1668L 56.9999,26.9168L 34.8334,53.8333L 19.0001,38L 23.7501,33.25 Z" Fill="#22B14C" Height="16" Width="16" Stretch="Fill" />
                      </Border>
                      <TextBlock Text="{Binding DateTime, ConverterParameter=11, Converter={StaticResource LurkingWifeModeStringConverter}, Mode=OneWay}" Grid.Column="1" />
                      <TextBlock Text="{Binding AmountBtc, ConverterParameter=8, Converter={StaticResource LurkingWifeModeStringConverter}, Mode=OneWay}" Grid.Column="2" Foreground="{Binding AmountBtc, Converter={StaticResource MoneyBrushConverter}}" />
                      <TextBlock IsVisible="{Binding !ClipboardNotificationVisible}" Text="{Binding TransactionId, ConverterParameter=50, Converter={StaticResource LurkingWifeModeStringConverter}, Mode=OneWay}" Grid.Column="3">
                        <i:Interaction.Behaviors>
                          <behaviors:CommandOnClickBehavior Command="{Binding RelativeSource={RelativeSource AncestorType=ListBox}, Path=DataContext.CopySelectedTxIdCommand}" />
                        </i:Interaction.Behaviors>
                      </TextBlock>
                      <Grid IsVisible="{Binding ClipboardNotificationVisible}" Grid.Column="3">
                        <Grid Opacity="{Binding ClipboardNotificationOpacity}">
                          <Grid.Transitions>
                            <DoubleTransition Property="Opacity" Easing="CircularEaseIn" Duration="0:0:0.5" />
                          </Grid.Transitions>
                          <TextBlock Text="Copied" Foreground="White" FontWeight="Bold" />
                        </Grid>
                      </Grid>
                      <TextBlock Text="{Binding Label, ConverterParameter=20, Converter={StaticResource LurkingWifeModeStringConverter}, Mode=OneWay}" Grid.Column="4"/>
                    </Grid>
                  </Grid>
                </DataTemplate>
              </controls:ExtendedListBox.ItemTemplate>
            </controls:ExtendedListBox>
          </controls:BusyIndicator>
        </DockPanel>
      </DockPanel>
    </Grid>
  </controls:GroupBox>
</UserControl>
